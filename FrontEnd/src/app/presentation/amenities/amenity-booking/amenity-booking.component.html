<div class="booking-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <button mat-icon-button class="back-button" [routerLink]="['/amenities', amenityId]">
        <mat-icon>arrow_back</mat-icon>
      </button>
      
      <div class="title-section">
        <h1 class="page-title">
          <mat-icon>event_available</mat-icon>
          Reservar Amenidad
        </h1>
        <p class="page-subtitle">Completa el formulario para realizar tu reserva</p>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando información...</p>
  </div>

  <!-- Booking Form -->
  <div class="booking-wrapper" *ngIf="!isLoading && amenity">
    <!-- Amenity Info Card -->
    <mat-card class="amenity-info-card">
      <div class="amenity-header">
        <div class="amenity-icon">
          <mat-icon>home_work</mat-icon>
        </div>
        <div class="amenity-details">
          <h2>{{ amenity.nombre }}</h2>
          <p class="amenity-location" *ngIf="amenity.ubicacion">
            <mat-icon>location_on</mat-icon>
            {{ amenity.ubicacion }}
          </p>
          <p class="amenity-type">{{ amenity.tipo }}</p>
        </div>
      </div>

      <mat-divider></mat-divider>

      <div class="amenity-specs">
        <div class="spec-item">
          <mat-icon>people</mat-icon>
          <div>
            <span class="spec-label">Capacidad Máxima</span>
            <span class="spec-value">{{ amenity.capacidad_maxima || amenity.capacidad || 'Sin límite' }}</span>
          </div>
        </div>

        <div class="spec-item" *ngIf="(amenity.horario_inicio || amenity.horario_apertura) && (amenity.horario_fin || amenity.horario_cierre)">
          <mat-icon>schedule</mat-icon>
          <div>
            <span class="spec-label">Horario</span>
            <span class="spec-value">{{ amenity.horario_inicio || amenity.horario_apertura }} - {{ amenity.horario_fin || amenity.horario_cierre }}</span>
          </div>
        </div>

        <div class="spec-item">
          <mat-icon>approval</mat-icon>
          <div>
            <span class="spec-label">Requiere Aprobación</span>
            <span class="spec-value">Todas las reservas requieren aprobación del administrador</span>
          </div>
        </div>
      </div>
    </mat-card>

    <!-- Booking Form Card -->
    <mat-card class="form-card">
      <h3>
        <mat-icon>event</mat-icon>
        Datos de la Reserva
      </h3>
      <mat-divider></mat-divider>

      <form [formGroup]="bookingForm" (ngSubmit)="onSubmit()">
        
        <!-- Date Section -->
        <div class="form-section">
          <h4>Fecha de Reserva</h4>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Fecha</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="fecha_reserva" [min]="minDate">
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-error *ngIf="bookingForm.get('fecha_reserva')?.invalid">
              {{ getErrorMessage('fecha_reserva') }}
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Time Section -->
        <div class="form-section">
          <h4>Horario</h4>

          <div class="form-grid">
            <mat-form-field appearance="outline">
              <mat-label>Hora de Inicio</mat-label>
              <input matInput type="time" formControlName="hora_inicio">
              <mat-error *ngIf="bookingForm.get('hora_inicio')?.invalid">
                {{ getErrorMessage('hora_inicio') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Hora de Fin</mat-label>
              <input matInput type="time" formControlName="hora_fin">
              <mat-error *ngIf="bookingForm.get('hora_fin')?.invalid">
                {{ getErrorMessage('hora_fin') }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Number of People Section -->
        <div class="form-section">
          <h4>Número de Personas</h4>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Cantidad de personas</mat-label>
            <input matInput type="number" formControlName="num_personas" min="1" [max]="getMaxCapacity()">
            <mat-hint *ngIf="amenity.capacidad_maxima || amenity.capacidad">
              Capacidad máxima: {{ getMaxCapacity() }} personas
            </mat-hint>
            <mat-error *ngIf="bookingForm.get('num_personas')?.invalid">
              {{ getErrorMessage('num_personas') }}
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Purpose Section -->
        <div class="form-section">
          <h4>Motivo de la Reserva</h4>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Describe el motivo</mat-label>
            <textarea matInput formControlName="motivo" rows="4"
              placeholder="Ej: Reunión familiar, celebración de cumpleaños, evento deportivo..."></textarea>
            <mat-hint>Mínimo 10 caracteres</mat-hint>
            <mat-error *ngIf="bookingForm.get('motivo')?.invalid">
              {{ getErrorMessage('motivo') }}
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Summary Section -->
        <div class="summary-section" *ngIf="bookingForm.get('fecha_reserva')?.value && bookingForm.get('hora_inicio')?.value">
          <h4>
            <mat-icon>summarize</mat-icon>
            Resumen de la Reserva
          </h4>
          <div class="summary-content">
            <div class="summary-item">
              <span class="summary-label">Amenidad:</span>
              <span class="summary-value">{{ amenity.nombre }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Fecha:</span>
              <span class="summary-value">{{ bookingForm.get('fecha_reserva')?.value | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Horario:</span>
              <span class="summary-value">{{ bookingForm.get('hora_inicio')?.value }} - {{ bookingForm.get('hora_fin')?.value }}</span>
            </div>
          </div>
        </div>

        <!-- Warning for approval -->
        <div class="warning-box">
          <mat-icon>info</mat-icon>
          <div>
            <strong>Nota importante:</strong>
            <p>Todas las reservas requieren aprobación del administrador. Recibirás una notificación una vez que sea revisada.</p>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button mat-stroked-button type="button" (click)="onCancel()" [disabled]="isSaving">
            <mat-icon>close</mat-icon>
            Cancelar
          </button>

          <button mat-raised-button color="primary" type="submit" [disabled]="bookingForm.invalid || isSaving">
            <mat-spinner *ngIf="isSaving" diameter="20"></mat-spinner>
            <mat-icon *ngIf="!isSaving">event_available</mat-icon>
            <span *ngIf="!isSaving">Confirmar Reserva</span>
          </button>
        </div>
      </form>
    </mat-card>
  </div>
</div>